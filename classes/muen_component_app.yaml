inherit: [muen_component, muen_component_cspecs]

depends:
  - muen::component-libmubase-ld
buildVars: [ARCH]
buildTools: [mucheckstack]
buildSetup: |
  __SRC=$1
  muenBuildApp() {
    muenCspecs $1
    GPRBUILD_EXTRA_ARGS="
      -Xlinker_script=${BOB_DEP_PATHS[muen::component-libmubase-ld]}/component.${ARCH}.ld \
      -Xstacksize=8192" \

    # check for arch-specific project file
    PRJ=${1}
    if [ -f "${__SRC}/${1}/${1}_${ARCH}.gpr" ]; then
      PRJ=${1}_${ARCH}
    fi
    muenBuild ${__SRC}/${1}/${PRJ}

    # stackcheck
    export OBJ_DIR=$(pwd)/build/obj/
    mucheckstack -P${__SRC}/${1}/${PRJ} -l8192
  }

packageTools: [mucbinsplit]
packageSetup: |
  __SRC=$1
  muenInstallApp() {
    mucbinsplit -i ${__SRC}/generated/$1.xml \
                -b ${__SRC}/install/usr/bin/$1 \
                -o $1.xml .
    mkdir -p .bob
    echo "$1.xml" > .bob/cspecs
  }
