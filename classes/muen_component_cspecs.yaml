depends:
  - ${MUEN_POLICY_SRC}

buildTools: [mucfgcvresalloc, muxmlfilter, mucgenspec, libxslt-tools]
buildVars: [MUEN_POLICY_SRC]
buildSetup: |
  mkdir -p generated
  export GENERATED=$(pwd)/generated
  export __SRC=$1

  muenCspecs() {
    IN_XSL=${2:-${__SRC}/components/${1}/spec/${1}.xsl}
    SPEC=${__SRC}/components/${1}/spec/${1}.xml
    if [ -e ${IN_XSL} ]; then
      xsltproc -o generated/${1}.xml \
         ${IN_XSL} \
         ${BOB_DEP_PATHS[${MUEN_POLICY_SRC}]}/policy_src.xml
      SPEC=generated/${1}.xml
    fi

    if [ -e ${SPEC} ]; then
      # cspecs
      mucfgcvresalloc  ${SPEC} \
        generated/${1}.xml -I generated

      # Filter xml cspecs
      muxmlfilter -isn Component_Ext -osn Component \
        generated/${1}.xml generated/${1}_filtered.xml

      # Generate cspecs
      mucgenspec -i generated/${1}_filtered.xml \
                 generated
    fi
  }
