checkoutSCM:
  scm: git
  url: https://git.codelabs.ch/rootfs-content.git
  branch: main
  commit: 96fd03a9781f9fed905854b53ce5347c6f5bcff6

buildScript: |
  rsync -a --delete $1/* .

# ROOTFS_OVERLAYS:
#   ;-separated list of directories to sync
#   over architecture base
packageVars: [ARCH, ROOTFS_OVERLAYS]
packageTools: [target-toolchain]
packageScript: |
  if [[ ${ARCH} == *x86* ]]; then
    rsync -a --delete $1/common/* $1/x86/* .
  else
    rsync -a --delete $1/common/* $1/arm64/* .
  fi

  if [[ -n ${ROOTFS_OVERLAYS:-} ]]; then
    IFS=';' read -r -a overlays <<< "$ROOTFS_OVERLAYS"
    for overlay in "${overlays[@]}"; do
      rsync -a $1/${overlay} .
    done;
  fi
