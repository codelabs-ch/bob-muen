inherit: [gpr]

depends:
  - muen::build-cfg-gpr

checkoutSCM:
  scm: git
  url: https://git.codelabs.ch/muen/rts
  branch: devel-x86-memmove
  commit: 9246c4b129c8c29902a9abe5ee84aef1df504ef2

buildTools: [target-toolchain, gprbuild]
buildVars: [ARCH, AUTOCONF_HOST]
buildScript: |
  mkdir -p obj/adainclude obj/adalib

  cp $1/src/*.ad* obj/adainclude
  cp -r $1/src/${ARCH}/* obj/adainclude

  gprbuild -P $1/rts \
    --target=${AUTOCONF_HOST} \
    --RTS=$(pwd)/obj \
    --relocate-build-tree=build \
    -XARCH=${ARCH} \
    -XBUILD_CFG=${BOB_DEP_PATHS[muen::build-cfg-gpr]}

  gprinstall -P$1/rts --relocate-build-tree=build \
    --target=${AUTOCONF_HOST} \
    --prefix=install/usr -p -f -m \
    -XARCH=${ARCH}

packageScript: |
  mkdir -p usr/include/rts/adainclude
  mkdir -p usr/include/rts/adalib
  cp $1/install/usr/gnat/* usr/include/rts/adainclude
  cp $1/install/usr/adalib/* usr/include/rts/adalib
