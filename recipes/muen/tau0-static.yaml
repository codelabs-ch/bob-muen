
checkoutSCM:
  scm: git
  url: https://git.codelabs.ch/muen/tau0.git
  branch: main
  commit: 9d7ee912d472910ba0ae40db93dc811d037e67b6

depends:
  - muen::build-cfg-scripts

buildTools: [libxslt-tools, tidy]
buildScript: |
  rm -rf generated && mkdir -p generated
  # XSLT command_stream
  xsltproc ${BOB_DEP_PATHS[muen::build-cfg-scripts]}/resolve.xsl \
           $1/schema/command_stream.xsd > generated/command_stream.xsd

  # Xml2Ada command_stream
  ${BOB_DEP_PATHS[muen::build-cfg-scripts]}/xml2ada Tau0.command_stream_schema \
    generated/command_stream.xsd generated/tau0-command_stream_schema.ads

  export GENERATED=$(pwd)/generated
multiPackage:
  "":
    depends:
      - adacore::xmlada-dev
      - muen::tools-libmutools-dev
    inherit: [muen_component]
    buildScript: |
      muenBuild $1/tau0

    packageScript: |
      installPackageBin $1/install/

    provideTools:
      tau0: "usr/bin"
  proof:
    inherit: [muen_proof]
    buildSetup: |
      export GPR_FILE=$1/tau0_proof.gpr
      export OBJ_DIR=$(pwd)/obj/
      export EXEC_DIR=$(pwd)/bin/
      export GPR_TARGET="x86_64-linux-gnu"
      export GNATPROVE_EXTRA_ARGS="--assumptions --no-loop-unrolling --no-axiom-guard"
    buildScript: |
      muenProof
